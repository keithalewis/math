<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Keith A. Lewis" />
  <meta name="dcterms.date" content="2020-10-29" />
  <title>Unified Finance</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="math.css" />
  <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      fleqn: true
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Unified Finance</h1>
<p class="author">Keith A. Lewis</p>
<p class="date">October 29, 2020</p>
</header>
<p>There is a unified way to organize the foundations of finance. A <em>holding</em> is the <em>amount</em> of an <em>instrument</em> held by a legal <em>entity</em>. A <em>transaction</em> is the exchange of holdings at a given time at a <em>price</em>. Instruments have <em>prices</em> and <em>cash flows</em> over time. that determine the values and amounts due to trading.</p>
<h2 id="holding">Holding</h2>
<p>Finance involves <em>instruments</em>, <em>amounts</em>, and <em>legal entities</em>. Examples of instruments are: stocks, bonds, futures, currencies, commodities, etc. They are held by entities in some amount: shares, notional, contracts, units, and physical quantity respectively. The holding <span class="math inline">(i,a,e)</span> indicates entity <span class="math inline">e</span> owns amount <span class="math inline">a</span> of instrument <span class="math inline">i</span>.</p>
<p>A <em>position</em> is a set of holdings <span class="math inline">\{(i_j,a_j,e_j)\}</span>. Assuming each instrument is <em>fungible</em> we can aggregate amounts. The <em>net amount</em> in instrument <span class="math inline">i</span> held by entity <span class="math inline">e</span> is <span class="math display">
N(i,e) = \sum_j \{a_j : i_j = i, e_j = e\}.
</span> The <em>net position</em> is <span class="math inline">\cup_j \{(i_j, N(i_j,e_j), e_j)\}</span>. (Note if <span class="math inline">i_j = i_k</span> and <span class="math inline">e_j = e_k</span> for some <span class="math inline">j,k</span> then <span class="math inline">(i_j, N(i_j,e_j), e_j) = (i_k, N(i_k,e_k), e_k)</span> so this is the standard mathematical set union.)</p>
<h2 id="transaction">Transaction</h2>
<p>A <em>transaction</em> involves a pair of holdings and a <em>transaction time</em>. The transaction <span class="math inline">(t; i, a, e; i&#39;, a&#39;, e&#39;)</span> indicates the the <em>buyer</em> <span class="math inline">e</span> exchanged amount <span class="math inline">a</span> of <span class="math inline">i</span> for amount <span class="math inline">a&#39;</span> of <span class="math inline">i&#39;</span> with the seller <span class="math inline">e&#39;</span> at time <span class="math inline">t</span>. The <em>price</em> for the transaction is <span class="math inline">X = a&#39;/a</span>. Prices are determined by the seller. The buyer decides the amount and instruments to exchange based on the seller’s price (among other considerations).</p>
<p>The transaction <span class="math inline">(t;i,a,e;i&#39;,a&#39;,e&#39;)</span> changes the holdings of <span class="math inline">e</span> and <span class="math inline">e&#39;</span> at time <span class="math inline">t</span> by replacing <span class="math inline">(i,a,e)</span> and <span class="math inline">(i&#39;,a&#39;,e&#39;)</span> with <span class="math inline">(i&#39;,a&#39;,e)</span> and <span class="math inline">(i,a,e&#39;)</span> in <span class="math inline">e</span> and <span class="math inline">e&#39;</span>’s holdings respectively. We assume instruments are <em>divisible</em> so a holding <span class="math inline">(i,a_1,e)</span> can be split into <span class="math inline">(i,a_1-a_0,e)</span> and <span class="math inline">(i,a_0,e)</span> for any amount <span class="math inline">a_0</span> at no cost if needed. If <span class="math inline">0 &lt; a_0 &lt; a_1</span> this is usually very close to being true.</p>
<p>As an example, suppose a buyer <span class="math inline">b</span> holds 16 dollars <span class="math inline">(\$, 16, b)</span> and a seller <span class="math inline">s</span> holds two shares of Ford stock <span class="math inline">(F, 2, s)</span>. If the seller quotes a price of 8 dollars per share then the buyer can obtain <span class="math inline">(2, F)</span> by giving the seller <span class="math inline">(\$, 16)</span>.</p>
<p>Foreign exchange is not a special case. If the USD/JPY exchange rate is 100 then <span class="math inline">(\$, a)</span> can be exchanged for <span class="math inline">(</span>¥<span class="math inline">,100a)</span>. If we write $1 = ¥100 then USD/JPY is 100 where ‘1 =’ turns into ‘<span class="math inline">/</span>’.</p>
<p>Similarly, commodities are also not special. This model can be used for <strong>all</strong> instruments.</p>
<h2 id="cash-flow">Cash Flow</h2>
<p>Instruments entail <em>cash flows</em>. Stocks pay dividends, bonds pays coupons, futures have margin adjustments. These cause changes to holdings. If instrument <span class="math inline">i</span> pays cash flow <span class="math inline">C_t(i,i&#39;)</span> per share of <span class="math inline">i</span> in instrument <span class="math inline">i&#39;</span> at time <span class="math inline">t</span> then holding <span class="math inline">(i,a,e)</span> will cause <span class="math inline">(i&#39;,aC_t(i,i&#39;),e)</span> to be included in the position of <span class="math inline">e</span> at <span class="math inline">t</span>. Usually <span class="math inline">i&#39;</span> is the native currency associated with instrument <span class="math inline">i</span> and is omitted. Specifying <span class="math inline">i&#39;</span> allows for <em>payment-in-kind</em> cash flows.</p>
<p>Note that cash flows are zero except at a discrete number of times. Stocks and bonds typically pay dividends and coupons quarterly or semi-annually. Futures margin accounts are usually adjusted once per day.</p>
<p>Cash flows do not depend on the entity holding the instrument. They do depend on the <em>issuer</em> of the instrument, but that is beyond the scope of this model.</p>
<h2 id="profit-and-loss">Profit and Loss</h2>
<p>Holdings and transactions lead to some bean counting over time.</p>
<p>Given a position at time <span class="math inline">t</span>, all transactions and cash flows between <span class="math inline">t</span> and <span class="math inline">u</span> determine the position at time <span class="math inline">u</span> as described above. The change in net amounts is called <em>profit and loss</em>. If <span class="math inline">N_t</span> is the net amount at time <span class="math inline">t</span> then <span class="math inline">N_u(i,e) - N_t(i,e)</span> is the P&amp;L for instrument <span class="math inline">i</span> and entity <span class="math inline">e</span> over the period from <span class="math inline">t</span> to <span class="math inline">u</span>.</p>
<p>Holdings can be converted into a native currency <span class="math inline">i_0</span> for reporting purposes. This does not involve actual transactions, only a best guess of the price at time <span class="math inline">t</span>, <span class="math inline">X_t(i_0,i)</span>, of each instrument <span class="math inline">i</span> in terms of <span class="math inline">i_0</span>. All holdings <span class="math inline">(i,a,e)</span> are converted to <span class="math inline">(i_0, aX(i_0,i), e)</span> then netted to report the P&amp;L in terms of <span class="math inline">i_0</span>.</p>
<p>Any instrument could be used instead of a native currency. A subset of instruments could also be chosen to break P&amp;L reporting into components. The set of all currencies involved in a position is a common choice.</p>
<h2 id="model">Model</h2>
<p>There is no question about the price of a transaction after it has settled. Mathematics can be used to <em>model</em> possible cash flows and prices in the future.</p>
<p>Let <span class="math inline">T</span> be the set of trading times, <span class="math inline">I</span> be the set of instruments, <span class="math inline">A</span> be the set of amounts, and <span class="math inline">E</span> be the set of entities.</p>
<p>Trading times can depend on the instrument. If an instrument is listed on an exchange then it can only be traded during market hours. Every seller gets to determine when the instruments they offer can be traded.</p>
<p>Amounts are constrained by the instrument and possibly also by the time and seller. Instruments trade in finite increments and sometimes cannot be shorted (<span class="math inline">a &lt; 0</span> is not allowed). The amount available is also at the discretion of the seller and may consist of the empty set for some buyers.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>A mathematical model for cash flows are functions <span class="math inline">C_t:I\times I\to\mathbf{R}</span>, where <span class="math inline">C_t(i,i&#39;)</span> is the amount per share of instrument <span class="math inline">i&#39;\in I</span> paid to the holder of <span class="math inline">i\in I</span> at time <span class="math inline">t</span>.</p>
<p>A mathematical model for prices is a (partial) function <span class="math inline">X_t\colon I\times A\times E\times I\times E\to\mathbf{R}</span>. At time <span class="math inline">t</span> the transaction <span class="math inline">(t;a,i,e;a X_t(i,a,e,i&#39;,e&#39;),i&#39;,e&#39;)</span> is available to the buyer <span class="math inline">e</span> from the seller <span class="math inline">e&#39;</span>. It is possible there are no quoted prices, as when <span class="math inline">t</span> is outside of market hours, so <span class="math inline">X_t</span> is only a partial function.</p>
<p>Most models of price in the financial literature do not depend on <span class="math inline">a</span>, <span class="math inline">e</span>, and <span class="math inline">e&#39;</span>. Anyone who has traded knows there are different prices depending on whether you are buying (<span class="math inline">a &gt; 0</span>) or selling (<span class="math inline">a &lt; 0</span>) – the ask and the bid price, respectively. Anyone who has traded large amounts also knows the bid/ask spread widens as the amount becomes large. The price can also depend on the counter-parties in the transaction, as anyone with poor credit will find when attempting to take out a loan.</p>
<h2 id="trading">Trading</h2>
<p>A <em>trading strategy</em> is an increasing sequence of <em>stopping times</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> <span class="math inline">(\tau_j)</span> and trades <span class="math inline">\Gamma_j\colon I\times E\times I\times E\to\mathbf{R}</span> indicating the amount to trade at time <span class="math inline">\tau_j</span> in two instruments between two entities. Each trade results in a transaction <span class="math inline">(\tau_j;\Gamma_j,i,e;\Gamma_j X_j, i&#39;, e&#39;)</span> where <span class="math inline">\Gamma_j = \Gamma_j(i, e, i&#39;, e&#39;)</span> and <span class="math inline">X_j = X_{\tau_j}(i,\Gamma_j,e,i&#39;,e&#39;)</span>.</p>
<p>Most models do not specify the seller <span class="math inline">e&#39;</span>; traders assume there is an aggregate market of <em>liquidity providers</em> for <span class="math inline">i&#39;</span>.</p>
<!--
The mathematical finance literature customarily assumes a "_money market_"
account is available to fund trade execution.  Funding trades actually
involves many fixed income instruments.  Traders at Big Banks use their
_funding desk_ to insulate themselves from the details, but they are
charged for this.  Daily positions funded by _repurchase agreements_
require at least as many instruments as the number of days involved in
trading. These may not be cost effective for longer term strategies so
forward rate agreements and swaps are often used.

The unified model for finance allows these to be easily integrated.
-->
<p>Trades accumulate into positions <span class="math inline">\Delta_t = \sum_{\tau_j &lt; t} \Gamma_j</span>. If we write <span class="math inline">\Gamma_t = \Gamma_j</span> if <span class="math inline">t = \tau_j</span> and <span class="math inline">\Gamma_t = 0</span> otherwise, this becomes <span class="math inline">\Delta_t = \sum_{s &lt; t} \Gamma_s</span>. Note the strict inequality. A trade executed at time <span class="math inline">t</span> is not included in the position at time <span class="math inline">t</span>; it takes some time for a trade to settle.</p>
<p>We will fix <span class="math inline">i = i_0</span> and write <span class="math inline">\Gamma_t(i_0, i) = \Gamma_t(i)</span> and <span class="math inline">X_t(i_0, i) = X_t(i)</span>. The <em>cost</em> of the initial trade in terms of <span class="math inline">i_0</span> is is <span class="math inline">V_0 = \sum_{i\in I}\Gamma_0(i) X_{\tau_0}(i)</span>. This amount will be deducted from the trader’s account and reported as the value of the position to risk management.</p>
<p>If we represent trades and prices as vectors indexed by instruments we can write this more simply as <span class="math inline">V_0 = \Gamma_0\cdot X_{\tau_0}</span> where the dot indicates the <em>inner product</em> of the vectors.</p>
<p>The <em>value</em>, or <em>mark-to-market</em> of a trading strategy at time <span class="math inline">t</span> is <span class="math display">
    V_t = (\Delta_t + \Gamma_t)\cdot X_t.
</span> This is the amount the trader would get from unwinding their existing position and the trades just executed at the prevailing market price, assuming that were possible. Note <span class="math inline">V_{\tau_0} = \Gamma_0\cdot X_{\tau_0}</span> is the cost of the initial trade.</p>
<p>Trading strategies cause <em>amounts</em> in <span class="math inline">i_0</span> to show up in the trader’s account: <span class="math display">
    A_t = \Delta_t\cdot C_t - \Gamma_t\cdot X_t.
</span> At time <span class="math inline">t</span> cash flows proportional the the existing position are credited and the cost of trades executed are debited. Note <span class="math inline">A_{\tau_0} = -\Gamma_0\cdot X_{\tau_0}</span>.</p>
<p>As described above, the model for cash flows and prices determine the holdings over time.</p>
<p>When the position <span class="math inline">\Delta_t = 0</span> we say the trading strategy is <em>closed out</em> at <span class="math inline">t</span>. If a trading strategy has <span class="math inline">A_{\tau_0} &gt; 0</span>, <span class="math inline">A_t \ge 0</span> for <span class="math inline">t &gt; \tau_0</span> and eventually closes out, then <em>arbitrage</em> exists (in the model): it is possible to make money on the initial trade and never lose money over the duration of the trading strategy.</p>
<p><a href="https://kalx.net/um.pdf">The Fundamental Theorem of Asset Pricing</a> describes all arbitrage-free models.</p>
<h2 id="remarks">Remarks</h2>
<p>The financial world is still waiting for its Werner Heisenberg. The price of a transaction is a number: the amount the buyer gave to the seller divided by the amount the seller gave to the buyer. Price is more nebulous prior to completing a transaction. The difference between a quoted price and the actual price is lumped into the term <em>slippage</em>.</p>
<p>Modeling that uncertainty is an unsolved problem.</p>
<p>For trades on an exchange the order book can tell you exactly what the slippage will be, but only rough details of the order book are available to exchange clients. Other clients and liquidity providers for the exchange can affect the order book before a trade gets executed.</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Adhering to the trader aphorism, “Don’t be a dick for a tick,” can help prevent this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>A <em>stopping time</em> is a random variable taking values in <span class="math inline">T</span> that depends only on prior information, for example when the price of a stock achieves a certain level.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</body>
</html>
