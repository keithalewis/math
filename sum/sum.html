<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Simple Unified Model</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\[', right: '\\]', display: true}, {left: '$', right: '$', display: false}, {left: '\\(', right: '\\)', display: false}]});"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            font-size: x-large;
            line-height: 120%;
            /*margin: 4rem 10rem 2rem 4rem;*/
            padding: 4em 5em;
            background-color: #f8f8f8;
            box-shadow: 0px 0px 1px red, 0px 0px 10px rgba(0, 0, 0, 0.7);
        }

        .underline {
            border-bottom: 1px dotted #333;
        }

        .katex-display {
            text-align: left !important;
            margin: 1em 0;
            padding-left: 2em;
        }

        .katex-display>.katex {
            text-align: left;
        }

        .graph {
            display: block;
            width: 50%;
            height: auto;
            margin: 1rem 0;
        }

        .hidden-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 1s ease;
        }

        .hidden-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .contact-float {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }

        .contact-float a {
            text-decoration: none;
            color: #333;
            font-size: 1.1rem;
            opacity: 0.7;
        }

        .contact-float a:hover {
            color: #0066cc;
        }
    </style>
</head>

<body>
    <div class="contact-float">
        <a href="mailto:kal@kalx.net?subject=Simplified!">kal@kalx.net</a>
    </div>

    <div class="hidden-content">
        <h1>Black-Scholes/Merton</h1>
        <p>
            Myron Scholes and Robert C. Merton III shared a
            <span title="Bank of Sweden Prize in Economic Sciences in Memory of Alfred Nobel" class="underline">Nobel
                Prize
                in Economics</span> in 1997 "for a new method to determine the <i>value</i> of derivatives."
            Their 1973 <a href="#references">papers</a> showed how to <i>hedge</i> stock options by continuously
            adjusting the
            amount (delta) of the underlying stock using a funding account.
            If there is no <i>arbitrage</i> then the value of an option is the cost of its initial hedge.
        </p>
        <p>
            By the end of the talk you will know what value, hedge, and arbitrage mean.
        </p>
        <!--
        <h2>Examples</h2>
        <p>
            What is the value of a derivative contract that pays the price of Netflix (NFLX) at one year from today?
        </p>
    </div>
    <div class="hidden-content">
        <p>
            It is equal to the price of NFLX today. Buy one share of NFLX today and sell it in one year to fulfill the
            contract.
        </p>
        <p>
            Of course you need to charge some vigorish for your efforts, something the Black-Scholes/Merton model does
            not account for.
        </p>
        <h3>Forward</h3>
        <p>
            You could also hedge using a <i>forward contract</i>. A forward contract on a stock with delivery in one
            year locks in
            the <i>forward price</i> of purchasing one share in one year. The cost of entering into the forward contract
            is zero.
        </p>
        <h3>Cost-of-carry</h3>
        <p>
            The current stock price is related to the forward price via the one-year <i>discount</i>, \(D\).
            Investing \(D\) today (in a bond) will yield 1 in one year so investing \(fD\) today will yield \(f\) in one
            year.
            If you hold a forward contract you can buy 1 share of stock for \(f\).
            This shows the current stock price \(S_0 = fD\) if there is no arbitrage.
        </p>
        <h3>Put-call parity</h3>
        <p>
            A common definition of a (European) <i>call option</i> is that it gives the buyer the right but not the
            obligation
            to purchase one share of stock at a fixed price (the <i>strike</i>) at a future date (the <i>expiration</i>).
        </p>
        <p>
            In reality a call option is a contract paying at expiration the stock price minus the strike if positive and
            zero otherwise.
            A <i>put option</i> is a contract paying the strike minus the stock price if positive and zero otherwise.
            Since \({\max(S_T - K, 0) + \max(K - S_T, 0) = S_T - K}\) a call plus put with the same strike and
            expiration
            is related to a forward contract with delivery price \(K\). The price of \(S_T - f\) is zero
            and \(S_T - K = (S_T - f) + (f - K)\) so the call plus put price is the discounted value of \(f - K\).
            This is called <i>put-call parity</i> and it is the first thing a trader checks when you hand them a new
            model.
        </p>
    </div>
    -->
        <div class="hidden-content">
            <h3>Option Formula</h3>
            <p>
                Black, Scholes, and Merton assume stock prices follow geometric Brownian motion. The price at time
                \(t\) is
                \[
                S_t = S_0 e^{\rho t} e^{\sigma B_t - \sigma^2t/2}
                \]
                where \((B_t)_{t \ge 0}\) is standard Brownian motion, \(\sigma\) is the <i>volatility</i>, and \(\rho\)
                is the
                <i>risk-free interest rate</i>.
            </p>
            <p>
                Using Ito processes and partial differential equations they derive the formula for the price
                of a European call option with strike \(K\) and expiration \(T\):
                \[
                C = S_0 N(d_1) - K e^{-\rho T} N(d_2)
                \]
                where
                \[
                d_1 = \frac{\ln(S_0/K) + (\rho + \sigma^2/2)T}{\sigma \sqrt{T}}, \quad
                d_2 = d_1 - \sigma \sqrt{T}
                \]
                and \(N(x) = \int_{-\infty}^x e^{-s^2/2}\,ds/\sqrt{2\pi}\) is the cumulative distribution function of
                the standard normal distribution.
            </p>
            <p>Whew!</p>
        </div>
        <div class="hidden-content">
            <h1>Stephen Ross</h1>
            <p>
                In 1978 Stephen Ross published "A simple approach to the valuation of risky streams" that derived the
                same
                option pricing formula using purely
                geometric arguments. It does not require stochastic calculus or partial differential equations, much
                less the
                assumption of a
                so-called "real world" measure that is immediately discarded for a "risk-neutral" measure.
                His theory also applies to <i>all</i> asset classes, not just a bond, stock, and option.
            </p>
            <p>
                Ross made the same physically untenable assumption as B-S/M that continuous time trading is possible.
                He also made the category error of assuming a jump in price is a cash flow.
                In the Equity world it is common knowledge that
                stock prices jump down by the dividend amount immediately after the issuer pays a dividend.
                But stock prices also "jump" between market close and market open where there is no corresponding cash
                flow.
            </p>
            <p>
                This can be rectified by accepting the reality that only a finite number of trades are possible and by
                putting cash flows on an equal footing with prices.
            </p>

        </div>

        <!--
        <p>
            A (European) call option with strike \(K\) pays \(\max(S_T - K, 0)\) at expiration \(T\) where \(S_T\) is the stock price at \(T\).
            This effectively allows the buyer to purchase one share of stock for at most price \(K\) at expiration.
        </p>
        <p>
            Consider a European call option on a non-dividend paying stock with
            
            Using the Black-Scholes/Merton formula, the option price \(C\) is given by:
            \[
            C = S_0 N(d_1) - K e^{-\rho T} N(d_2)
            \]
             Plugging in the values, we find:
            \[
            d_1 = 0.35, \quad d_2 = 0.15
            \]
            Thus,
            \[
            C = 100 N(0.35) - 100 e^{-0.05} N(0.15) \approx 100 \times 0.6368 - 95.12 \times 0.5596 \approx
            63.68 - 53.22 = 10.46
            \]
            Therefore, the price of the European call option is approximately $10.46.
        </p>
        -->
        <!--
    B-S/M 

    Measure 
    -->

        <div class="hidden-content">
            <h1>Simple Unified Model</h1>

            <h2>I) Market</h2>
            <p>Market instruments have <i>prices</i> \(X_t\) and <i>cash flows</i> \(C_t\) over time.</p>
            <svg id="market" class="graph" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <marker id="arrowhead" markerWidth="5" markerHeight="3.5" refX="4.5" refY="1.75" orient="auto">
                        <polyline points="0 0, 5 1.75, 0 3.5" fill="none" stroke="#333" stroke-width="1" />
                    </marker>
                    <marker id="arrowhead-green" markerWidth="5" markerHeight="3.5" refX="4.5" refY="1.75"
                        orient="auto-start-reverse">
                        <polyline points="0 0, 5 1.75, 0 3.5" fill="none" stroke="#00cc66" stroke-width="1" />
                    </marker>
                </defs>
                <g transform="translate(20, 120) scale(1, -1)">
                    <!-- Axes -->
                    <line x1="0" y1="0" x2="100" y2="0" stroke="#333" stroke-width="0.5" marker-end="url(#arrowhead)" />
                    <line x1="0" y1="0" x2="0" y2="100" stroke="#333" stroke-width="0.5" marker-end="url(#arrowhead)" />

                    <!-- Right axis for cash flow -->
                    <line x1="100" y1="0" x2="100" y2="100" stroke="#333" stroke-width="0.5"
                        marker-end="url(#arrowhead)" />

                    <!-- Geometric Brownian Motion path -->
                    <path id="gbm-path" d="" fill="none" stroke="#0066cc" stroke-width="1" />

                    <!-- Vertical line at x=20 -->
                    <line x1="20" y1="0" x2="20" y2="20" stroke="#00cc66" stroke-width="1" />

                    <!-- Wiggly line at x=50 -->
                    <path d="M 50,0 Q 48,2.5 50,5 T 50,10 Q 48,12.5 50,15 T 50,20 Q 48,22.5 50,24 L 50,26" fill="none"
                        stroke="#00cc66" stroke-width="1" />

                    <text x="110" y="0" font-size="11" fill="#333" font-style="italic" text-anchor="left"
                        dominant-baseline="middle" transform="scale(1, -1)">time</text>
                    <text x="0" y="-110" font-size="11" fill="#0066cc" font-style="italic" text-anchor="middle"
                        transform="scale(1, -1)">price</text>
                    <text x="100" y="-110" font-size="11" fill="#00cc66" font-style="italic" text-anchor="middle"
                        transform="scale(1, -1)">cash flow</text>
                </g>
            </svg>

        </div>
        <div class="hidden-content">
            <h2>II) Trading</h2>
            <p>
                Traders buy <i>shares</i> \(\Gamma_j\) of instruments
                at times \(\tau_j\) that accumulate into <i>positions</i> \(\Delta_t = \sum_{\tau_j < t} \Gamma_j\).
                    </p>
                    <svg id="trading" class="graph" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <marker id="arrowhead" markerWidth="5" markerHeight="3.5" refX="4.5" refY="1.75"
                                orient="auto">
                                <polyline points="0 0, 5 1.75, 0 3.5" fill="none" stroke="#333" stroke-width="1" />
                            </marker>
                        </defs>
                        <g transform="translate(20, 120) scale(1, -1)">
                            <!-- Axes -->
                            <line x1="0" y1="0" x2="100" y2="0" stroke="#333" stroke-width="0.5"
                                marker-end="url(#arrowhead)" />
                            <text x="110" y="0" font-size="11" fill="#333" font-style="italic" text-anchor="left"
                                dominant-baseline="middle" transform="scale(1, -1)">time</text>
                            <line x1="0" y1="0" x2="0" y2="100" stroke="#333" stroke-width="0.5"
                                marker-end="url(#arrowhead)" />
                            <text x="0" y="-110" font-size="11" fill="#cc0066" font-style="italic" text-anchor="middle"
                                transform="scale(1, -1)">position</text>

                            <!-- Trading line with closed circle -->
                            <line x1="0" y1="0" x2="20" y2="0" stroke="#cc0066" stroke-width="1" />
                            <circle cx="20" cy="0" r="2" fill="#cc0066" />
                            <!-- Dashed line with open circle -->
                            <line x1="20" y1="0" x2="20" y2="28" stroke="#cc0066" stroke-width="1"
                                stroke-dasharray="3,3" />
                            <circle cx="20" cy="30" r="2" fill="none" stroke="#cc0066" stroke-width="1" />
                            <text x="20" y="10" font-size="11" fill="#333" font-style="italic" text-anchor="middle"
                                transform="scale(1, -1)">τ₀</text>
                            <text x="15" y="-12" font-size="11" fill="#cc0066" font-style="italic" text-anchor="end"
                                transform="scale(1, -1)">Γ₀</text>

                            <!-- Horizontal line with closed circle -->
                            <line x1="22" y1="30" x2="40" y2="30" stroke="#cc0066" stroke-width="1" />
                            <circle cx="40" cy="30" r="2" fill="#cc0066" />
                            <!-- Dashed line with open circle -->
                            <line x1="40" y1="30" x2="40" y2="78" stroke="#cc0066" stroke-width="1"
                                stroke-dasharray="3,3" />
                            <circle cx="40" cy="80" r="2" fill="none" stroke="#cc0066" stroke-width="1" />
                            <text x="42" y="10" font-size="11" fill="#333" font-style="italic" text-anchor="middle"
                                transform="scale(1, -1)">τ₁</text>
                            <text x="36" y="-52" font-size="11" fill="#cc0066" font-style="italic" text-anchor="end"
                                transform="scale(1, -1)">Γ₁</text>


                            <!-- Horizontal line with closed circle -->
                            <line x1="42" y1="80" x2="80" y2="80" stroke="#cc0066" stroke-width="1" />
                            <circle cx="40" cy="30" r="2" fill="#cc0066" />
                            <!-- Dashed line with open circle -->
                            <line x1="40" y1="30" x2="40" y2="78" stroke="#cc0066" stroke-width="1"
                                stroke-dasharray="3,3" />
                            <circle cx="40" cy="80" r="2" fill="none" stroke="#cc0066" stroke-width="1" />
                            <text x="42" y="10" font-size="11" fill="#333" font-style="italic" text-anchor="middle"
                                transform="scale(1, -1)">τ₁</text>
                            <text x="36" y="-52" font-size="11" fill="#cc0066" font-style="italic" text-anchor="end"
                                transform="scale(1, -1)">Γ₁</text>

                            <text x="-4" y="-28" font-size="11" fill="#cc0066" font-style="italic" text-anchor="end"
                                transform="scale(1, -1)">Δ₀</text>
                            <text x="-4" y="-78" font-size="11" fill="#cc0066" font-style="italic" text-anchor="end"
                                transform="scale(1, -1)">Δ₁</text>
                        </g>
                    </svg>
        </div>
        <div class="hidden-content">
            <h2>III) Accounting</h2>
            <p>Accountants keep track of <i>amount</i>s. Cash flows are received proportional to position and
                shares are bought at market price.
                \[
                A_t = \Delta_t\cdot C_t - \Gamma_t\cdot X_t
                \]
            <p>The <i>mark-to-market value</i> is the amount that would be
                received from liquidating the existing position and
                trades just done at the current market price.
                \[
                V_t = (\Delta_t + \Gamma_t)\cdot X_t
                \]
            </p>
        </div>
        <div class="hidden-content">
            <h2>IV) Arbitrage</h2>
            <p>A trading strategy \((\tau_j, \Gamma_j)\) that makes money
                on the first trade; never loses money after that; and closes out:
                \[
                A_{\tau_0} > 0;\, A_t \ge 0, t > \tau_0;\, \sum_j \Gamma_j = 0
                \]
        </div>
        <div class="hidden-content">
            <h2>V) Fundamental Theorem of Asset Pricing</h2>

            <p>If there is no arbitrage then there exist positive measures \((D_t)_{t\in T}\) with
                \[
                \underline{X_t} D_t = \sum_{t < u \le v} \underline{\underline{C_u}} D_u + \underline{X_v} D_v|_{\mathcal{A}_t}. \]
                    <span style="color: grey;">Note \(Y=E[X|\mathcal{A}]\) if and only if
                    \(Y(P|_\mathcal{A})=(XP)|_\mathcal{A}\).
                    Read \(|_{\mathcal{A}_t}\) as "given information available at time \(t\)".
                    </span> </p>
            <p>

                These are are what Ross called a "(not generally unique) positive linear operator that can
                be
                used to
                value all marketed assets." If a funding account is available then \(D_t\) is its
                reciprocal:
                the <i> stochastic discount</i>.</p>
            </p>
        </div>
        <div class="hidden-content">
            <h2>Consequences</h2>

            <p>
                Given the 5 easy pieces we have
                \[
                \underline{V_t} D_t = \sum_{t < u \le v} \underline{\underline{A_u}} D_u + \underline{V_v} D_v|_{\mathcal{A}_t} \]
                    Note how value \(V_t\) corresponds to price \(X_t\) and amount \(A_t\) corresponds to cash flow
                    \(C_t\). <blockquote>
                    <strong>Trading strategies create synthetic market instruments.</strong>
                    </blockquote>
        </div>
        <div class="hidden-content">
            <h3>Derivative</h3>
            <p>
                A <i>derivative instrument</i> is a contract for a risky stream of cash flows. The seller
                agrees to pay the buyer cash flows \((\hat{A}_j)\) on dates \((\hat{\tau}_j)\).
                A <i>hedge</i> is a trading strategy \((\tau_t, \Gamma_t)\) such that the
                \(A_t = \hat{A}_j\) when \(t = \hat{\tau}_j\) and is zero otherwise.
            </p>
            <h4>Value</h4>
            <p>
                The <i>value</i> of a derivative is the cost of setting up a hedge.
                \[
                V_t D_t = \sum_{\hat{\tau_j} > t} \hat{A}_j D_{\hat{\tau_j}}|_{\mathcal{A}_t}
                \]
                Note the value is determined by the contract information and the stochastic discount.
            </p>
            <h4>Hedge</h4>
            <p>How do you find the initial hedge?
                Since \(V_0 = \Gamma_0\cdot X_0\) the derivative of the initial value \(V_0\)
                with respect to the initial price \(X_0\) gives the initial hedge \(D_{X_0}V_0 = \Gamma_0\).
            </p>
            <p>How do you hedge over time?
                Since \(V_t = (\Delta_t + \Gamma_t)\cdot X_t\) the derivative of the value \(V_t\)
                with respect to the price \(X_t\) gives the hedge \(D_{X_t}V_t = \Delta_t + \Gamma_t\)
                so
                \[
                \Gamma_t = D_{X_t}V_t - \Delta_t = D_{X_t}V_t - \sum_{s < t} \Gamma_s. \] </p>
                    <p>When do you hedge? Continuously is the "completely correct" answer!</p>
        </div>
        <div class="hidden-content">

            <h3>Universal Model</h3>
            <p>
                If \((M_t)_{t\in T}\) are vector-valued measures with
                \(M_t = M_u|_{\mathcal{A}_t}\) for \(t \le u\)
                then the price process
                \[
                X_t D_t = M_t - \sum_{s\le t} C_s D_s
                \]
                is arbitrage free.
            <blockquote>
                <strong>Every arbitrage free price process has this form.</strong>
            </blockquote>
            For example, the Black-Scholes/Merton model is \(D_t = e^{-\rho t}P\),
            \(M_t = (1, se^{\sigma B_t - \sigma^2t/2}) P\),
            where \(P\) is Wiener measure for Brownian motion \((B_t)_{t \ge 0}\).
            </p>
            <p>
				The Fischer Black model does not require interest rates. It
				only considers forward values.
                If \(F = fe^{sZ - s^2/2}\) where \(Z\) is standard normal then
				\(E[F] = f\) since \(E[e^N] = e^{E[N] + \operatorname{Var}(N)/2}\).

				For any
				payoff \(\phi\) we have
                \(E[F \phi(F)] = f E[\phi(Fe^{s^2})]\).
				For a put payoff $\phi(x) = \max\{k - x, 0\}$
                \[ E[(k - F)^+] = E[(k - F)1(F \le k)] = k P(F \le k) - E[F 1(F \le k)] \]
                \[
                E[F 1(F \le k)] = f P(F e^{s^2} \le k) = f P(F \le ke^{-s^2})
                \]
				This provides a simpler derivation of the option pricing formula
				\[
					E[(k - F)^+] = kP(F\le k) - fP(F\le ke^{-s^2})
				\]
            </p>
        </div>

        <div class="hidden-content">
            <h2 id="references">References</h2>
            <ul>
                <li>Black, F. and Scholes, M. (1973). "The Pricing of Options and Corporate Liabilities".
                    <i>Journal of Political Economy</i>, 81(3): 637–654.
                </li>

                <li>Merton, R. C. (1973). "Theory of Rational Option Pricing".
                    <i>Bell Journal of Economics and Management Science</i>, 4(1): 141–183.
                </li>

                <li>Ross, S. A. (1978). "A simple approach to the valuation of risky streams". Journal of Business.
                    51
                    (3):
                    453–475. doi:10.1086/295992.</li>

                <li>Lewis, K. A. (2019). "A Simple Proof of the Fundamental Theorem of Asset Pricing".
                    <i>arXiv preprint</i> arXiv:1912.01091 [q-fin.MF].
                    <a href="https://arxiv.org/abs/1912.01091">https://arxiv.org/abs/1912.01091</a>
                </li>
                <li>Lewis, K. A. (2025). <a href="https://keithalewis.github.io/math/sum.html">"Simple Unified
                        Model"</a>.</li>
            </ul>
        </div>

        <script>

            function lineElement(x1, y1, x2, y2,
                { stroke = '#333', strokeWidth = 1, markerEnd = null } = {}) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');

                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', stroke);
                line.setAttribute('stroke-width', strokeWidth);
                if (markerEnd) {
                    line.setAttribute('marker-end', markerEnd);
                }

                return line;
            }
            function animateElement(attributeName, from, to,
                { dur = '1s', fill = 'freeze', begin = '0s' } = {}) {
                const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');

                animate.setAttribute('attributeName', attributeName);
                animate.setAttribute('from', from);
                animate.setAttribute('to', to);
                animate.setAttribute('dur', dur);
                animate.setAttribute('fill', fill);
                animate.setAttribute('begin', begin);

                return animate;
            }

            function drawTrading() {
                const svg = document.getElementById('trading');
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');

                // Set attributes
                g.setAttribute('class', 'graph');
                g.setAttribute('transform', 'translate(20, 120) scale(1, -1)');

                // Append to SVG
                svg.appendChild(g);

                // Add children to the group
                g.appendChild(lineElement(0, 0, 5, 0, { markerEnd: 'url(#arrowhead)' }))
                    .appendChild(animateElement('x2', '5', '100', { dur: '1s' }));
                //    <text x="110" y="0" font-size="12" fill="#333" font-style="italic" text-anchor="left"
                //            dominant-baseline="middle" transform="scale(1, -1)">time</text>

                const line2 = lineElement(0, 0, 0, 5, { markerEnd: 'url(#arrowhead)' });
                line2.setAttribute('visibility', 'hidden');

                // Make visible when animation starts
                const setVisible = document.createElementNS('http://www.w3.org/2000/svg', 'set');
                setVisible.setAttribute('attributeName', 'visibility');
                setVisible.setAttribute('to', 'visible');
                setVisible.setAttribute('begin', '1s');
                line2.appendChild(setVisible);

                line2.appendChild(animateElement('y2', '5', '100', { dur: '1s', begin: '1s' }));
                g.appendChild(line2);
            }

            //drawTrading();

            // Draw Geometric Brownian Motion
            function drawGBM() {
                const path = document.getElementById('gbm-path');
                const numPoints = 100;
                const dt = 1 / numPoints;
                const mu = 0.5; // drift
                const sigma = .5; // volatility
                const S0 = 50; // initial price

                let S = S0;
                let pathData = `M 0,${S}`;

                for (let i = 1; i <= numPoints; i++) {
                    // Generate random normal using Box-Muller transform
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);

                    // GBM formula: S_t = S_0 * exp((mu - sigma^2/2)*t + sigma*sqrt(t)*Z)
                    const t = i * dt;
                    S = S0 * Math.exp((mu - sigma * sigma / 2) * t + sigma * Math.sqrt(dt) * z);

                    // Scale to fit in viewBox
                    const x = i;
                    const y = Math.min(Math.max(S, 0), 100);

                    pathData += ` L ${x},${y}`;
                }

                path.setAttribute('d', pathData);
            }

            drawGBM();

            // Custom smooth scroll with controllable duration
            function smoothScrollTo(targetY, duration = 500) {
                const startY = window.pageYOffset;
                const distance = targetY - startY;
                const startTime = performance.now();

                function animation(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    // Easing function (ease-in-out)
                    const easeProgress = progress < 0.5
                        ? 2 * progress * progress
                        : 1 - Math.pow(-2 * progress + 2, 2) / 2;

                    window.scrollTo(0, startY + distance * easeProgress);

                    if (progress < 1) {
                        requestAnimationFrame(animation);
                    }
                }

                requestAnimationFrame(animation);
            }

            // Scroll reveal functionality
            function revealOnScroll() {
                const hiddenElements = document.querySelectorAll('.hidden-content');

                hiddenElements.forEach(element => {
                    const elementTop = element.getBoundingClientRect().top;
                    const windowHeight = window.innerHeight;

                    // Reveal when scrolling down into view
                    if (elementTop < windowHeight - 150 && !element.classList.contains('visible')) {
                        element.classList.add('visible');

                        // Auto-scroll to element bottom + offset
                        setTimeout(() => {
                            const elementRect = element.getBoundingClientRect();
                            const absoluteElementBottom = elementRect.bottom + window.pageYOffset;
                            const offset = 5 * parseFloat(getComputedStyle(document.documentElement).fontSize);

                            smoothScrollTo(absoluteElementBottom + offset - window.innerHeight, 2000);
                        }, 500);
                    }
                });
            }

            // Run on scroll
            window.addEventListener('scroll', revealOnScroll);

            // On load, make only the first hidden-content visible
            window.addEventListener('load', () => {
                const firstHidden = document.querySelector('.hidden-content');
                if (firstHidden) {
                    firstHidden.classList.add('visible');
                }
            });
        </script>
</body>

</html>
